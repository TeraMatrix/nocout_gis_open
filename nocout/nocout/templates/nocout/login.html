{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta charset="utf-8"/>
    <title> Wireless1 </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no"/>
    <meta name="description" content=""/>
    <meta name="author" content="Teramatrix"/>
    <!-- STYLESHEETS -->
    <!--[if lt IE 9]>
    <script src="js/flot/excanvas.min.js"></script>
    <script src={% static "html5/html5.js" %}></script>
    <script src={% static "media-ie/css3-mediaqueries.js" %}></script>
    <![endif]-->
    <!-- CLOUD ADMIN STYLE-->
    <link rel="stylesheet" type="text/css" href={% static "css/cloud-admin.css" %} />
    <!-- FONT AWESOME STYLE-->
    <link href={% static "font-awesome/css/font-awesome.min.css" %} rel="stylesheet" />
    <!-- ANIMATE -->
    <link rel="stylesheet" type="text/css" href={% static "css/animatecss/animate.min.css" %} />
    <!-- FONTS -->
    <link rel="stylesheet" type="text/css" href={% static "css/theme_fonts.css" %} />
    <!-- Gritter Notification -->
    <link rel="stylesheet" type="text/css" href={% static "js/gritter/css/jquery.gritter.css" %} />
    <!--JQUERY-->
    <script src={% static "js/jquery/jquery-1.11.1.min.js" %}></script>
</head>


<body class="login">
<!-- session_security -->
{% include "session_security/all.html" %}
<!-- session_security -->
<!-- PAGE -->
<section id="page">
    <!-- HEADER -->
    <header>
        <!-- NAV-BAR -->
        <div class="container">
            <div class="row">
                <div class="col-md-4 col-md-offset-4">
                    <div id="logo">
{#                        <a href="index.html">#}
{#                            <img src="{% static 'img/logo/login_logo.png' %}" height="40" alt="logo name"/>#}
{#                        </a>#}
                    </div>
                </div>
            </div>
        </div>
        <!--/NAV-BAR -->
    </header>
    <!--/HEADER -->
    <!-- LOGIN -->
    <section id="login" class="visible">
        <div class="container">
            <div class="row">
                <div class="col-md-4 col-md-offset-4">
                    <div class="login-box-plain">
                        <h2 class="bigintro">Sign In</h2>

                        <div class="divide-40"></div>
                        <form id='login_form' role="form" action="/auth/" method="post">{% csrf_token %}
                            <div class="form-group">
                                <label for="username">Username</label>
                                <i class="fa fa-envelope"></i>
                                <input type="text" style="padding: 7px 8px 6px;" class="form-control" id="username" name="username" value=""/>
                            </div>
                            <div class="form-group">
                                <label for="exampleInputPassword1">Password</label>
                                <i class="fa fa-lock"></i>
                                <input type="password" style="padding: 7px 8px 6px;" class="form-control" id="password" name="password">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-danger">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="hide" id="ajax_spinner" align="center"></div>
    </section>
    <!--/LOGIN -->
  </section>
  <!--/PAGE -->
  <!-- JAVASCRIPTS -->
  <!-- Placed at the end of the document so the pages load faster -->
  <!-- BOOTSTRAP -->
  <script src={% static "bootstrap-dist/js/bootstrap.min.js" %}></script>
  <!-- BOOTBOX -->
  <script type="text/javascript" src={% static "js/bootbox/bootbox.min.js" %}></script>
  <!-- Gritter Notification -->
  <script type="text/javascript" src={% static "js/gritter/js/jquery.gritter.min.js" %}></script>
  <!-- AJAX CSRF -->
  <script type="text/javascript" src={% static "js/ajax_csrf.js" %}></script>
  <!-- Library for page spinner-->
  <script type="text/javascript" src={% static "js/spin/spin.js" %}></script>

  <script>

      /*Spinner configuration object*/
      var spinner_options = {
          lines: 15, // The number of lines to draw
          length: 16, // The length of each line
          width: 2, // The line thickness
          radius: 10, // The radius of the inner circle
          corners: 1, // Corner roundness (0..1)
          rotate: 0, // The rotation offset
          direction: 1, // 1: clockwise, -1: counterclockwise
          color: '#000', // #rgb or #rrggbb or array of colors
          speed: 0.8, // Rounds per second
          trail: 100, // Afterglow percentage
          shadow: false, // Whether to render a shadow
          hwaccel: false, // Whether to use hardware acceleration
          className: 'spinner', // The CSS class to assign to the spinner
          zIndex: 2e9, // The z-index (defaults to 2000000000)
          top: '50%', // Top position relative to parent
          left: '50%' // Left position relative to parent
      };
      /*Spinner DOM Element*/
      var dom_target = document.getElementById('ajax_spinner');

      /*Triggers when login form is submitted*/
      $("#login_form").on("submit", function (event) {

        var username = $.trim($("#username").val()),
            pass = $("#password").val();
        /*If username or password field is blank*/
        if(username.length == 0 || pass.length == 0) {
          /*Error Message*/
          var blank_field_msg = "Username & Password are required for login.";
          /*Call gritter.add() to show the gritter popup*/
          var mandatory_gritter = $.gritter.add({
            title: "Mandatory Fields",
            text: blank_field_msg,
            sticky: true,
            after_close: function () {
              $.gritter.remove(mandatory_gritter);
            }
          });
        } else {

          if($("#ajax_spinner").hasClass("hide")) {
              /*Show ajax_spinner div*/
              $("#ajax_spinner").removeClass("hide")
              /*Initialize spinner object*/
              var spinner = new Spinner(spinner_options).spin(dom_target);
              /*If ajax_backdrop div not exist then appent it to body */
              if($("#ajax_backdrop").length == 0) {
                  $("body").append('<div class="modal-backdrop fade in" id="ajax_backdrop"></div>');
              }            
          }

          /*Make ajax call to the server*/
          $.ajax({   
            url: "/auth/",
            type: "POST",
            data: $("#login_form").serialize(true) + location.search.replace('?','&'),
            dataType: "json",
            success: function (data) {

              if (data.success == 1) {
                if (data.data.objects.dialog) {
                  bootbox.dialog({
                    message: "This account is active on a different computer, " +
                            "Press continue login with another account or kill all other sessions and continue with this login",
                    title: "Login Alert",
                    buttons: {
                        success: {
                            label: "Logoff all other sessions & Login",
                            className: "btn-success",
                            callback: function () {
                                $.ajax({
                                           url: "/sm/dialog_action/",
                                           type: "POST",
                                           data: { action: 'continue', url:data.data.objects.url },
                                           dataType: "json",
                                           success: function (data) {
                                               window.location.replace(data.data.objects.url)
                                           }//success
                                       });//ajax
                            }//callback function
                        },//buttonsuccess


                        danger: {
                            label: "Cancel and login with a separate account",
                            className: "btn-danger",
                            callback: function () {
                                $.ajax({
                                           url: "/sm/dialog_action/",
                                           type: "POST",
                                           data: { action: 'logout'},
                                           dataType: "json",
                                           success: function (data) {
                                               window.location.replace(data.data.objects.url)
                                           }//success
                                       });//ajax
                            }//callback function
                        }//buttonsuccess
                      } //button
                  });//bootbox end
                }// if end for data dialogue
                else {
                  window.location.replace(data.data.objects.url);
                }
              }//if end
              else if (data.success == 0) {
                var unique_gritter = $.gritter.add({
                  title: data.message,
                  text: data.data.objects.reason,
                  sticky: true,
                  after_close: function () {
                      $.gritter.removeAll();
                  }
                });
              }//else if end
              else {
                window.location.replace(data.data.objects.url);
              }

              /*Remove backdrop div & hide spinner*/
              $("#ajax_backdrop").remove();
              if(!($("#ajax_spinner").hasClass("hide"))) {
                  /*Hide ajax_spinner div*/
                  $("#ajax_spinner").addClass("hide");
              }
              
            }//success
          });//Ajax
        }
        return false;
      });//onclick

  </script>
<!-- /JAVASCRIPTS -->
</body>
</html>
