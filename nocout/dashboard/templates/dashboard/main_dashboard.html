{% extends "nocout/base.html" %}
{% load staticfiles %}
{% block page_setting_block %} {% endblock %}
{% block content_title %} Dashboard {% endblock %}
{% block content_description %} Dashboard... {% endblock %}
{% block css %}
    <link rel="stylesheet" type="text/css" href={% static "css/nocout_dashboard.css" %}>
{% endblock %}

{% block content %}
    <div class="col-md-12">
        <div class="col-md-6 box-container ui-sortable">
            <div class="box">
                <div class="box-title" style="background-color: transparent;">
                    <h3>PMP Sector Capacity</h3>
                </div>
                <div class="box-body">
                    <div id="pmp_cam_ul_util_kpi" class="rf_chart_style"></div>
                </div>
            </div>
        </div>

        <div class="col-md-6 box-container ui-sortable">
            <div class="box">
                <div class="box-title" style="background-color: transparent;">
                    <h3>PMP Sector Capacity</h3>
                </div>
                <div class="box-body">
                    <div id="pmp_cam_dl_util_kpi" class="rf_chart_style"></div>
                </div>
            </div>
        </div>

        <div class="col-md-6 box-container ui-sortable">
            <div class="box">
                <div class="box-title" style="background-color: transparent;">
                    <h3>WIMAX Sector Capacity</h3>
                </div>
                <div class="box-body">
                    <div id="wimax_cam_ul_util_kpi" class="rf_chart_style"></div>
                </div>
            </div>
        </div>

        <div class="col-md-6 box-container ui-sortable">
            <div class="box">
                <div class="box-title" style="background-color: transparent;">
                    <h3>WIMAX Sector Capacity</h3>
                </div>
                <div class="box-body">
                    <div id="wimax_cam_dl_util_kpi" class="rf_chart_style"></div>
                </div>
            </div>
        </div>

        <div class="col-md-6 box-container ui-sortable">
            <div class="box">
                <div class="box-title" style="background-color: transparent;">
                    <h3>PMP Sales Opportunity</h3>
                </div>
                <div class="box-body">
                    <div id="pmp_sales_opportunity" class="rf_chart_style"></div>
                </div>
            </div>
        </div>

        <div class="col-md-6 box-container ui-sortable">
            <div class="box">
                <div class="box-title" style="background-color: transparent;">
                    <h3>WIMAX Sales Opportunity</h3>
                </div>
                <div class="box-body">
                    <div id="wimax_sales_opportunity" class="rf_chart_style"></div>
                </div>
            </div>
        </div>

    </div>
{% endblock %}
{% block load_js %}

<!--Highcharts Library-->
<script src={% static "js/highcharts.js" %}></script>
<!-- SPARKLINES -->
<script type="text/javascript" src={% static "js/sparklines/jquery.sparkline.min.js" %}></script>
<!-- Dashboard Custom CSS-->
<script src={% static "js/nocout_dashboard.js" %}></script>

<script>
    jQuery(document).ready(function () {
        App.setPage("");  //Set current page
        App.init(); //Initialise plugins and elements

        series = 3;
        var pieChartLegends = [];
        var pie_color_array = ["#99CC00", "#FFE90D", "#FF0022"];

        pieChartLegends.push("Good");
        pieChartLegends.push("Warning");
        pieChartLegends.push("Critical");

        var data_sources = {{ data_sources|safe }};
        ds_list = {{ data_sources|safe }};

        technology = ['pmp', 'wimax']

        if(ds_list.length > 0) {
            // start API calling
            wimax_getChartData(0);
            pmp_getChartData(0);
        } else {
            /*hide spinner*/
            hideSpinner();
        }

        pmp_opportunity_getChartData(0)
        pmp_opportunity_getChartData(1)
    });


function pmp_getChartData(counter) {
    showSpinner();
    if(ds_list[counter]) {
        var data_source_title = ds_list[counter] ? ds_list[counter].toUpperCase() : "";

        $.ajax({
            url : "{% url 'sector-capacity-pmp' %}" + "?data_source=" + ds_list[counter],
            type : "GET",
            success : function(result) {
                var response = "";
                if(typeof result == 'string') {
                    response = JSON.parse(result);
                } else {
                    response = result;
                }

                if(response.success == 1) {
                    var domElement = 'pmp_' + ds_list[counter];
                    var pie_chart = $('#' + domElement).highcharts({
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false
                        },
                        title: {
                            text: response.data.objects.chart_data[0].name
                            // text: ''
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false,
                                },
                                showInLegend: true
                            }
                        },
                        colors: response.data.objects.colors,
                        series: [{
                            type: 'pie',
                            name: response.data.objects.display_name,
                            data: response.data.objects.chart_data[0].data
                        }],
                        events: {
                            load : function() {
                                console.log("DONE");
                            }
                        }
                    });
                } else {
                    hideSpinner();
                    console.log('unsuccess')
                }
            },
            error : function(err) {
                hideSpinner();
                console.log(err)
            },
            complete : function() {
                // recursive function calling
                var count = counter;
                if(ds_list[count++]) {
                    pmp_getChartData(count);
                    if (ds_list.length == count){
                        hideSpinner();
                    }
                }
            }
        });
    }
}

function wimax_getChartData(counter) {
    showSpinner();
    if(ds_list[counter]) {
        var data_source_title = ds_list[counter] ? ds_list[counter].toUpperCase() : "";

        $.ajax({
            url : "{% url 'sector-capacity-wimax' %}" + "?data_source=" + ds_list[counter],
            type : "GET",
            success : function(result) {
                var response = "";
                if(typeof result == 'string') {
                    response = JSON.parse(result);
                } else {
                    response = result;
                }

                if(response.success == 1) {
                    var domElement = 'wimax_' + ds_list[counter];
                    var pie_chart = $('#' + domElement).highcharts({
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false
                        },
                        title: {
                            text: response.data.objects.chart_data[0].name
                            // text: ''
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        colors: response.data.objects.colors,
                        series: [{
                            type: 'pie',
                            name: response.data.objects.display_name,
                            data: response.data.objects.chart_data[0].data
                        }],
                        events: {
                            load : function() {
                                console.log("DONE");
                            }
                        }
                    });
                } else {
                    hideSpinner();
                    consolo.log('unsuccess')
                }
            },
            error : function(err) {
                hideSpinner();
                consolo.log(err)
            },
            complete : function() {
                // recursive function calling
                var count = counter;
                if(ds_list[count++]) {
                    wimax_getChartData(count);
                    if (ds_list.length == count){
                        hideSpinner();
                    }
                }
            }
        });
    }
}

function pmp_opportunity_getChartData(counter) {
    showSpinner();
    if(ds_list[counter]) {
        var data_source_title = 'Topology';

        $.ajax({
            url : "{% url 'sales-opportunity-pmp' %}" + "?data_source=topology",
            type : "GET",
            success : function(result) {
                var response = "";
                if(typeof result == 'string') {
                    response = JSON.parse(result);
                } else {
                    response = result;
                }

                if(response.success == 1) {
                    var domElement = technology[counter]+'_sales_opportunity';
                    var pie_chart = $('#' + domElement).highcharts({
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false
                        },
                        title: {
                            text: response.data.objects.chart_data[0].name
                            // text: '',
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        // colors: response.data.objects.colors,
                        series: [{
                            type: 'pie',
                            name: response.data.objects.display_name,
                            data: response.data.objects.chart_data[0].data
                        }],
                        events: {
                            load : function() {
                                console.log("DONE");
                            }
                        }
                    });
                } else {
                    hideSpinner();
                    console.log('unsuccess')
                }
            },
            error : function(err) {
                hideSpinner();
                console.log(err)
            },
            complete : function() {
            }
        });
    }
}

function wimax_opportunity_getChartData(counter) {
    showSpinner();
    if(ds_list[counter]) {
        var data_source_title = 'Topology';

        $.ajax({
            url : "{% url 'sales-opportunity-pmp' %}" + "?data_source=topology",
            type : "GET",
            success : function(result) {
                var response = "";
                if(typeof result == 'string') {
                    response = JSON.parse(result);
                } else {
                    response = result;
                }

                if(response.success == 1) {
                    var domElement = technology[counter]+'_sales_opportunity';
                    var pie_chart = $('#' + domElement).highcharts({
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false
                        },
                        title: {
                            text: response.data.objects.chart_data[0].name
                            // text: '',
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        // colors: response.data.objects.colors,
                        series: [{
                            type: 'pie',
                            name: response.data.objects.display_name,
                            data: response.data.objects.chart_data[0].data
                        }],
                        events: {
                            load : function() {
                                console.log("DONE");
                            }
                        }
                    });
                } else {
                    hideSpinner();
                    console.log('unsuccess')
                }
            },
            error : function(err) {
                hideSpinner();
                console.log(err)
            },
            complete : function() {
            }
        });
    }
}

</script>
{% endblock %}
