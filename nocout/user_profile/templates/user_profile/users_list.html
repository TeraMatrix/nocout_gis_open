{% extends "department/department.html" %}
{% load staticfiles %}
{% block css %}
    {#    <link rel="stylesheet" type="text/css" href={% static "user_profile/css/user_profile.css" %}>#}
{% endblock %}
{% block breadcrumb_page_title %} > User {% endblock %}
{% block content_title %}Users Management{% endblock %}
{% block content %}
    <p><a href="/user/new"><i class="fa fa-plus">&nbsp;</i> Create User</a></p>

    <div class="box border lite">
        <div id="tableContainer_div" class="box-title">
            <h4><i class="fa fa-table"></i>USER LISTING</h4>

            <div class="tools hidden-xs">
                <a href="#box-config" data-toggle="modal" class="config">
                    <i class="fa fa-cog"></i>
                </a>
                <a href="javascript:;" class="reload">
                    <i class="fa fa-refresh"></i>
                </a>
                <a href="javascript:;" class="collapse">
                    <i class="fa fa-chevron-up"></i>
                </a>
                <a href="javascript:;" class="remove">
                    <i class="fa fa-times"></i>
                </a>

            </div>
        </div>
        <div id="tableContainer" class="box-body">
            <table cellpadding="0" cellspacing="0" border="0"
                   class="datatable table table-striped table-bordered table-hover" id="UserTable">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block jquery %}
    <script type="text/javascript" src={% static "js/utils/jqueryDataTable.js" %}></script>
    <script type="text/javascript">

        $(document).ready(function (e) {
            /*Make a instance of ourDataTableWidget class */
            var dataTableInstance = new ourDataTableWidget();

            /*Call createDataTable function of ourDataTableWidget class*/
            var tableObject = $.parseJSON('{{ datatable_headers|safe }}');
            var ajax_url = '{% url "UserListingTable" %}'
            dataTableInstance.createDataTable("UserTable", tableObject, ajax_url);

            $('.datatable').each(function () {
                var datatable = $(this);
                // SEARCH - Add the placeholder for Search and Turn this into in-line form control
                var search_input = datatable.closest('.dataTables_wrapper').find('div[id$=_filter] input');
                search_input.attr('placeholder', 'Search');
                search_input.addClass('form-control input-sm');
                // LENGTH - Inline-Form control
                var length_sel = datatable.closest('.dataTables_wrapper').find('div[id$=_length] select');
                length_sel.addClass('form-control input-sm');
            });
        });
        function get_soft_delete_form(content) {
            // soft_delete_html: contains html for soft delete form
            var soft_delete_html;
            if (!(typeof content.result.data.objects.child_users === 'undefined') && !(Object.keys(content.result.data.objects.child_users).length === 0)) {
                soft_delete_html = '<h5 class="text-warning">This user (' + content.result.data.objects.user_name + ') is parent of following users:</h5>';
                for (var i = 0, l = content.result.data.objects.child_users.length; i < l; i++) {
                    soft_delete_html += '<span class="text-warning">' + (i + 1) + ' : ' + content.result.data.objects.child_users[i].value + ' </span><br />';
                }
                if (!(typeof content.result.data.objects.eligible_users === 'undefined')) {
                    soft_delete_html += '<h5 class="text-danger">Please first choose future parent of these users from below choices:</h5>';
                    soft_delete_html += '<input type="hidden" id="id_user" name="user" value="' + content.result.data.objects.user_id + '" />';
                    soft_delete_html += '<select class="form-control" id="id_parent" name="parent">';
                    soft_delete_html += '<option value="">Select User</option>';
                    for (var i = 0, l = content.result.data.objects.eligible_users.length; i < l; i++) {
                        soft_delete_html += '<option value="' + content.result.data.objects.eligible_users[i].key + '">' + content.result.data.objects.eligible_users[i].value + '</option>';
                    }
                    soft_delete_html += '</select>';
                }
            }
            else {
                soft_delete_html = '<h5 class="text-warning">This user is not associated with any other user. So click on Yes! if you want to delete it.</h5>';
                soft_delete_html += '<input type="hidden" id="id_user" name="user" value="' + content.result.data.objects.user_id + '" />';
                soft_delete_html += '<input type="hidden" id="id_parent" name="parent" value="" />'
            }
            bootbox.dialog({
                message: soft_delete_html,
                title: "<span class='text-danger'><i class='fa fa-times'></i> Delete User</span>",
                buttons: {
                    success: {
                        label: "Yes!",
                        className: "btn-success",
                        callback: function () {
                            Dajaxice.user_profile.user_soft_delete(test, {
                                'user_id': $('#id_user').val(),
                                'new_parent_id': $('#id_parent').val()});

                        }
                    },
                    danger: {
                        label: "No!",
                        className: "btn-danger",
                        callback: function () {
                            bootbox.alert("Ok! You choose to not delete this user right now.", function () {
                                $(".bootbox").modal("hide");
                            });
                        }
                    }
                }
            });
        }
        function test(responseResult) {
            bootbox.alert(responseResult.result.message);
        }

    </script>

{% endblock %}
