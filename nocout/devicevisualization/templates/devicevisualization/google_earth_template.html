{% extends "nocout/base.html" %}
{% block breadcrumb_title %}
    <li>Network Maps</li>
    <li>Google Earth</li>
{% endblock %}
{% block content_title %}Google Earth{% endblock %}
{% block content_description %}Location wise devices distribution{% endblock %}
{% load staticfiles %}
{% block css %}
    <link rel="stylesheet" type="text/css" href={% static "css/style.css" %}>
    <!-- JQUERY UI-->
    <link rel="stylesheet" type="text/css" href={% static "js/jquery-ui-1.10.3.custom/css/custom-theme/jquery-ui-1.10.3.custom.min.css" %} />
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <link rel="stylesheet" href={% static "js/jquery-upload/css/jquery.fileupload.css" %}>
    <link rel="stylesheet" href={% static "js/jquery-upload/css/jquery.fileupload-ui.css" %}>
{% endblock %}

{% block page_setting_block %}
    <!-- GIS Page  -->
    <span class="date-range pull-right">
        <div class="btn-group">
            <ul class="list-unstyled list-inline">
                <li>
                    <button id="advFilterBtn" class="btn btn-info" onclick="showAdvFilters();" data-complete-text="<i class='fa fa-filter'></i> Advance Filters" data-loading-text="Please Wait...">
                        <i class='fa fa-filter'></i> Advance Filters
                    </button>
                    <button id="removeFilterBtn" class="btn btn-danger hide" onclick="removeAdvFilters();" style="margin-left:10px;">
                        <i class='fa fa-times'></i> Remove Filters
                    </button>                    
                </li>
                <li>
                    <span class="btn btn-success fileinput-button">
                        <i class="fa fa-plus"></i>
                        <span id="fileName">Add File</span>
                        <input type="file" name="kmlFile" id="kmlFile">
                    </span>
                </li>
                <li>
                    <button class="btn btn-primary start" id="kmlImportBtn">
                        <i class="fa fa-arrow-circle-o-up"></i>
                        <span>Import</span>
                    </button>
                </li>
            </ul>            
        </div>
    </span>
    <!-- /DATE RANGE PICKER -->
{% endblock %}

{% block content %}
<div class='box border lite mapContainerBlock'>
    <div class='box-title'>
        <h4><i class='fa fa-map-marker'></i> GOOGLE Earth <i class="fa fa-spinner fa fa-spin" id="loadingIcon">&nbsp;</i></h4>
        <!--Filters Block Start-->
        <div class="pull-right">
            <ul class="list-unstyled list-inline">
                <li>
                    <!--technology Filter-->
                    <select name="technology" id="technology" class="form-control col-xs-1 input-sm">
                        <option value="">Select Technology</option>
                    </select>   
                </li>
                <li>
                    <!--vendor Filter-->
                    <select name="vendor" id="vendor" class="form-control col-xs-1 input-sm">
                        <option value="">Select Vendor</option>
                    </select>
                </li>
                <li>
                    <!--State Filter-->
                    <select name="state" id="state" class="form-control col-xs-1 input-sm">
                        <option value="">Select State</option>
                    </select>
                </li>
                <li>
                    <!--City Filter-->
                    <select name="city" id="city" class="form-control col-xs-1 input-sm">
                        <option value="">Select City</option>
                    </select>   
                </li>
                <li>
                    <!--Reset Button-->
                    <button class="btn btn-sm btn-inverse form-control col-xs-1 input-sm" id="resetFilters" data-complete-text="<i class='fa fa-refresh'></i> Refresh" data-loading-text="Please Wait...">
                        <i class="fa fa-refresh">&nbsp;</i> Reset
                    </button>
                </li>
            </ul>
        </div>
        <!--Filters Block End-->
        <div class="clear"></div>
    </div>
    <div class='box-body' style="position:relative">
        <!--div on which the map is to be plot-->

        <!--Google Earth Container Start-->
        <div id="google_earth_container"></div>
        <!--Google Earth Container End-->
    </div>
</div>

<!-- Google Earth Library-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<!-- Our Library to plot the devices on map & performs functionality accordingly-->
<script type="text/javascript" src={% static "js/advanceSearchLib.js" %}></script>
<!-- Our Library-->
<script type="text/javascript" src={% static "js/earth_devicePlottingLib.js" %}></script>
<script type="text/javascript">
    
    var earth_instance = "";
    google.load("earth", "1");
    
    $(document).ready(function(e) {
                
        earth_instance = new googleEarthClass();
        earth_instance.createGoogleEarth('google_earth_container');
    });
    /*Change event on file input*/
    $("#kmlFile").on('change',function(e) {        
        var fileName = $.trim($("#kmlFile")[0].files[0].name);
        var fileNameArray = fileName.split(".");
        var fileExtension = $.trim(fileNameArray[fileNameArray.length - 1]);
        if(fileName.length > 0) {
            if(fileExtension.toUpperCase() == "KML" || fileExtension.toUpperCase() == "KMZ" ) {
                $("#fileName").html(fileName);
            } else {
                $("#kmlFile")[0].value = "";
                $("#fileName").html("Add File");
                alert("Please select KML or KMZ file to import data");
            }
        } else {
            $("#fileName").html("Add File");
        }
    });

    /*Click event on file upload*/
    $("#kmlImportBtn").click(function(e) {
        var fileExist = $.trim($("#kmlFile")[0].value);
        if(fileExist.length > 0) {
            earth_instance.importKmlData($("#kmlFile"));
        } else {
            alert("Please select KML or KMZ file to import data");
        }
    });
</script>
{% endblock %}

{% block load_js %}
<!-- /JAVASCRIPTS -->

<script>
    jQuery(document).ready(function () {
        App.setPage("");  //Set current page
        App.init(); //Initialise plugins and elements
    });
</script>
{% endblock %}